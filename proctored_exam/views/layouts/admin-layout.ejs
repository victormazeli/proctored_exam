<!-- views/layouts/admin-layout.ejs -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %> | Admin - Certification Practice Platform</title>
  
  <!-- Favicon -->
  <link rel="icon" href="/images/favicon.ico" type="image/x-icon">
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'ui-sans-serif', 'system-ui', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', 'sans-serif'],
          },
          colors: {
            primary: {
              50: '#f0f9ff',
              100: '#e0f2fe',
              200: '#bae6fd',
              300: '#7dd3fc',
              400: '#38bdf8',
              500: '#0ea5e9',
              600: '#0284c7',
              700: '#0369a1',
              800: '#075985',
              900: '#0c4a6e',
            },
          },
        },
      },
    };
  </script>
  
  <!-- Additional CSS -->
  <link rel="stylesheet" href="/css/admin.css">
  
  <!-- Custom Styles -->
  <% if (typeof styles !== 'undefined') { %>
    <style>
      <%= styles %>
    </style>
  <% } %>
</head>
<body class="min-h-screen flex bg-gray-100 text-gray-800">
  <!-- Sidebar -->
  <aside class="admin-sidebar bg-gray-800 text-white w-64 flex-shrink-0 hidden md:block">
    <div class="sidebar-header p-4 border-b border-gray-700">
      <div class="flex items-center">
        <img class="h-8 w-auto mr-3" src="/images/logo-white.svg" alt="Logo">
        <div>
          <h1 class="text-lg font-semibold">Admin Panel</h1>
          <p class="text-xs text-gray-400">Certification Practice Platform</p>
        </div>
      </div>
    </div>
    
    <nav class="sidebar-nav p-4">
      <ul class="space-y-1">
        <li>
          <a href="/admin" class="nav-item <%= path === '/admin' ? 'active' : '' %>">
            <i class="fas fa-tachometer-alt"></i>
            <span>Dashboard</span>
          </a>
        </li>
        
        <li class="nav-section">
          <span class="nav-section-title">Content Management</span>
        </li>
        <li>
          <a href="/admin/certifications" class="nav-item <%= path === '/admin/certifications' ? 'active' : '' %>">
            <i class="fas fa-certificate"></i>
            <span>Certifications</span>
          </a>
        </li>
        <li>
          <a href="/admin/exams" class="nav-item <%= path === '/admin/exams' ? 'active' : '' %>">
            <i class="fas fa-file-alt"></i>
            <span>Exams</span>
          </a>
        </li>
        <li>
          <a href="/admin/questions" class="nav-item <%= path === '/admin/questions' ? 'active' : '' %>">
            <i class="fas fa-question-circle"></i>
            <span>Questions</span>
          </a>
        </li>
        
        <li class="nav-section">
          <span class="nav-section-title">Users & Analytics</span>
        </li>
        <li>
          <a href="/admin/users" class="nav-item <%= path === '/admin/users' ? 'active' : '' %>">
            <i class="fas fa-users"></i>
            <span>Users</span>
          </a>
        </li>
        <li>
          <a href="/admin/analytics" class="nav-item <%= path === '/admin/analytics' ? 'active' : '' %>">
            <i class="fas fa-chart-bar"></i>
            <span>Analytics</span>
          </a>
        </li>
        
        <li class="nav-section">
          <span class="nav-section-title">Monitoring</span>
        </li>
        <li>
          <a href="/admin/active-exams" class="nav-item <%= path === '/admin/active-exams' ? 'active' : '' %>">
            <i class="fas fa-video"></i>
            <span>Active Proctored Exams</span>
            <span id="active-exams-count" class="nav-badge">0</span>
          </a>
        </li>
        <li>
          <a href="/admin/flagged-questions" class="nav-item <%= path === '/admin/flagged-questions' ? 'active' : '' %>">
            <i class="fas fa-flag"></i>
            <span>Flagged Questions</span>
            <span id="flagged-questions-count" class="nav-badge">0</span>
          </a>
        </li>
      </ul>
    </nav>
    
    <div class="sidebar-footer p-4 mt-auto border-t border-gray-700">
      <div class="flex items-center">
        <div class="w-8 h-8 rounded-full bg-gray-600 flex items-center justify-center mr-3">
          <span class="text-sm font-medium">
            <%= user ? user.username.substring(0, 2).toUpperCase() : 'AD' %>
          </span>
        </div>
        <div>
          <p class="text-sm font-medium"><%= user ? user.username : 'Admin' %></p>
          <p class="text-xs text-gray-400">Administrator</p>
        </div>
      </div>
      <div class="mt-3 flex justify-between">
        <a href="/auth/profile" class="text-xs text-gray-400 hover:text-white">Profile</a>
        <a href="/auth/logout" class="text-xs text-gray-400 hover:text-white">Logout</a>
      </div>
    </div>
  </aside>
  
  <!-- Mobile sidebar toggle and header -->
  <div class="md:hidden fixed top-0 left-0 right-0 z-30 bg-gray-800 text-white">
    <div class="flex items-center justify-between p-4">
      <button id="mobile-menu-toggle" class="block text-white focus:outline-none">
        <i class="fas fa-bars"></i>
      </button>
      <div class="flex items-center">
        <img class="h-8 w-auto mr-3" src="/images/logo-white.svg" alt="Logo">
        <h1 class="text-lg font-semibold">Admin Panel</h1>
      </div>
      <div class="w-8 h-8 rounded-full bg-gray-600 flex items-center justify-center">
        <span class="text-sm font-medium">
          <%= user ? user.username.substring(0, 2).toUpperCase() : 'AD' %>
        </span>
      </div>
    </div>
  </div>
  
  <!-- Mobile Sidebar (hidden by default) -->
  <div id="mobile-sidebar" class="fixed inset-0 z-20 transform -translate-x-full transition-transform duration-300 ease-in-out md:hidden">
    <div class="absolute inset-0 bg-gray-900 opacity-50" id="mobile-sidebar-backdrop"></div>
    <div class="absolute left-0 top-0 bottom-0 w-64 bg-gray-800 text-white">
      <!-- Mobile sidebar content (clone of desktop sidebar) -->
      <div class="sidebar-header p-4 border-b border-gray-700 mt-16">
        <div class="flex items-center">
          <img class="h-8 w-auto mr-3" src="/images/logo-white.svg" alt="Logo">
          <div>
            <h1 class="text-lg font-semibold">Admin Panel</h1>
            <p class="text-xs text-gray-400">Certification Practice Platform</p>
          </div>
        </div>
      </div>
      
      <nav class="sidebar-nav p-4">
        <ul class="space-y-1">
          <li>
            <a href="/admin" class="nav-item <%= path === '/admin' ? 'active' : '' %>">
              <i class="fas fa-tachometer-alt"></i>
              <span>Dashboard</span>
            </a>
          </li>
          
          <li class="nav-section">
            <span class="nav-section-title">Content Management</span>
          </li>
          <li>
            <a href="/admin/certifications" class="nav-item <%= path === '/admin/certifications' ? 'active' : '' %>">
              <i class="fas fa-certificate"></i>
              <span>Certifications</span>
            </a>
          </li>
          <li>
            <a href="/admin/exams" class="nav-item <%= path === '/admin/exams' ? 'active' : '' %>">
              <i class="fas fa-file-alt"></i>
              <span>Exams</span>
            </a>
          </li>
          <li>
            <a href="/admin/questions" class="nav-item <%= path === '/admin/questions' ? 'active' : '' %>">
              <i class="fas fa-question-circle"></i>
              <span>Questions</span>
            </a>
          </li>
          
          <li class="nav-section">
            <span class="nav-section-title">Users & Analytics</span>
          </li>
          <li>
            <a href="/admin/users" class="nav-item <%= path === '/admin/users' ? 'active' : '' %>">
              <i class="fas fa-users"></i>
              <span>Users</span>
            </a>
          </li>
          <li>
            <a href="/admin/analytics" class="nav-item <%= path === '/admin/analytics' ? 'active' : '' %>">
              <i class="fas fa-chart-bar"></i>
              <span>Analytics</span>
            </a>
          </li>
          
          <li class="nav-section">
            <span class="nav-section-title">Monitoring</span>
          </li>
          <li>
            <a href="/admin/active-exams" class="nav-item <%= path === '/admin/active-exams' ? 'active' : '' %>">
              <i class="fas fa-video"></i>
              <span>Active Proctored Exams</span>
              <span id="mobile-active-exams-count" class="nav-badge">0</span>
            </a>
          </li>
          <li>
            <a href="/admin/flagged-questions" class="nav-item <%= path === '/admin/flagged-questions' ? 'active' : '' %>">
              <i class="fas fa-flag"></i>
              <span>Flagged Questions</span>
              <span id="mobile-flagged-questions-count" class="nav-badge">0</span>
            </a>
          </li>
        </ul>
      </nav>
      
      <div class="sidebar-footer p-4 mt-auto border-t border-gray-700">
        <div class="flex items-center">
          <div class="w-8 h-8 rounded-full bg-gray-600 flex items-center justify-center mr-3">
            <span class="text-sm font-medium">
              <%= user ? user.username.substring(0, 2).toUpperCase() : 'AD' %>
            </span>
          </div>
          <div>
            <p class="text-sm font-medium"><%= user ? user.username : 'Admin' %></p>
            <p class="text-xs text-gray-400">Administrator</p>
          </div>
        </div>
        <div class="mt-3 flex justify-between">
          <a href="/auth/profile" class="text-xs text-gray-400 hover:text-white">Profile</a>
          <a href="/auth/logout" class="text-xs text-gray-400 hover:text-white">Logout</a>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Main Content -->
  <div class="admin-content flex-grow md:ml-64 mt-16 md:mt-0">
    <div class="p-6">
      <!-- Flash Messages -->
      <% if (typeof success_msg !== 'undefined' && success_msg.length > 0) { %>
        <div class="flash-message success">
          <div class="flex items-center bg-green-100 border border-green-200 text-green-800 px-4 py-3 rounded relative mb-6" role="alert">
            <i class="fas fa-check-circle mr-2"></i>
            <span><%= success_msg %></span>
            <button class="flash-close absolute top-0 bottom-0 right-0 px-4 py-3">
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>
      <% } %>
      
      <% if (typeof error_msg !== 'undefined' && error_msg.length > 0) { %>
        <div class="flash-message error">
          <div class="flex items-center bg-red-100 border border-red-200 text-red-800 px-4 py-3 rounded relative mb-6" role="alert">
            <i class="fas fa-exclamation-circle mr-2"></i>
            <span><%= error_msg %></span>
            <button class="flash-close absolute top-0 bottom-0 right-0 px-4 py-3">
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>
      <% } %>
      
      <% if (typeof info_msg !== 'undefined' && info_msg.length > 0) { %>
        <div class="flash-message info">
          <div class="flex items-center bg-blue-100 border border-blue-200 text-blue-800 px-4 py-3 rounded relative mb-6" role="alert">
            <i class="fas fa-info-circle mr-2"></i>
            <span><%= info_msg %></span>
            <button class="flash-close absolute top-0 bottom-0 right-0 px-4 py-3">
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>
      <% } %>
      
      <%- body %>
    </div>
  </div>
  
  <!-- Scripts -->
  <script>
    // Mobile menu toggle
    document.addEventListener('DOMContentLoaded', function() {
      const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
      const mobileSidebar = document.getElementById('mobile-sidebar');
      const mobileSidebarBackdrop = document.getElementById('mobile-sidebar-backdrop');
      
      mobileMenuToggle.addEventListener('click', function() {
        mobileSidebar.classList.toggle('-translate-x-full');
      });
      
      mobileSidebarBackdrop.addEventListener('click', function() {
        mobileSidebar.classList.add('-translate-x-full');
      });
      
      // Flash message dismissal
      const flashCloseButtons = document.querySelectorAll('.flash-close');
      
      flashCloseButtons.forEach(button => {
        button.addEventListener('click', function() {
          const flashMessage = this.closest('.flash-message');
          flashMessage.classList.add('fade-out');
          
          setTimeout(() => {
            flashMessage.remove();
          }, 300);
        });
      });
      
      // Auto-dismiss flash messages after 5 seconds
      setTimeout(() => {
        document.querySelectorAll('.flash-message').forEach(message => {
          message.classList.add('fade-out');
          
          setTimeout(() => {
            if (message.parentNode) {
              message.remove();
            }
          }, 300);
        });
      }, 5000);
      
      // Fetch active counts for badges
      fetchActiveCounts();
      
      // Refresh counts every 60 seconds
      setInterval(fetchActiveCounts, 60000);
    });
    
    // Fetch active counts for the badges
    function fetchActiveCounts() {
      // Fetch active exams count
      fetch('/admin/active-exams/count')
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            const count = data.count;
            const countElement = document.getElementById('active-exams-count');
            const mobileCountElement = document.getElementById('mobile-active-exams-count');
            
            countElement.textContent = count;
            mobileCountElement.textContent = count;
            
            if (count > 0) {
              countElement.classList.add('has-count');
              mobileCountElement.classList.add('has-count');
            } else {
              countElement.classList.remove('has-count');
              mobileCountElement.classList.remove('has-count');
            }
          }
        })
        .catch(error => console.error('Error fetching active exams count:', error));
      
      // Fetch flagged questions count
      fetch('/admin/flagged-questions/count')
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            const count = data.count;
            const countElement = document.getElementById('flagged-questions-count');
            const mobileCountElement = document.getElementById('mobile-flagged-questions-count');
            
            countElement.textContent = count;
            mobileCountElement.textContent = count;
            
            if (count > 0) {
              countElement.classList.add('has-count');
              mobileCountElement.classList.add('has-count');
            } else {
              countElement.classList.remove('has-count');
              mobileCountElement.classList.remove('has-count');
            }
          }
        })
        .catch(error => console.error('Error fetching flagged questions count:', error));
    }
  </script>
  
  <style>
    /* Admin Layout Styles */
    .admin-sidebar {
      @apply fixed inset-y-0 left-0 z-20 flex flex-col;
      width: 16rem;
    }
    
    .admin-content {
      @apply w-full min-h-screen;
    }
    
    .nav-section {
      @apply mt-6 mb-2;
    }
    
    .nav-section-title {
      @apply block px-4 text-xs font-semibold text-gray-400 uppercase tracking-wider;
    }
    
    .nav-item {
      @apply flex items-center px-4 py-2 text-gray-300 rounded-md hover:bg-gray-700 hover:text-white transition-colors;
    }
    
    .nav-item i {
      @apply w-5 text-center mr-3;
    }
    
    .nav-item.active {
      @apply bg-gray-900 text-white;
    }
    
    .nav-badge {
      @apply ml-auto text-xs bg-gray-700 text-gray-300 rounded-full w-5 h-5 flex items-center justify-center;
    }
    
    .nav-badge.has-count {
      @apply bg-red-500 text-white;
    }
    
    .fade-out {
      @apply opacity-0 transition-opacity duration-300;
    }
    
    @media (min-width: 768px) {
      .admin-content {
        margin-left: 16rem;
      }
    }
  </style>
  
  <% if (typeof scripts !== 'undefined') { %>
    <script>
      <%= scripts %>
    </script>
  <% } %>
</body>
</html>